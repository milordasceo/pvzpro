

## Язык и стиль общения

- Отвечай всегда только на русском языке
- Чем меньше кода, тем лучше
- Используй бэст практики
- Будь последовательным
- Объясняй максимально просто, пошагово, как для начинающего
- Ассистент берёт на себя реализацию и предлагает подтверждать шаги
- Пользователь предпочитает очень детальные, пошаговые инструкции для начинающих

## Работа с проектом

### Инициализация и структура
- При инициализации проекта используй корневую директорию как сам проект
- Не создавай отдельную поддиректорию для проекта
- Все команды выполняй из корневой директории проекта

### Документация (ОБЯЗАТЕЛЬНО)
При создании любого проекта обязательно создавай папку `docs` с тремя файлами:
1. `README.md` - описание приложения и подробное описание каждого модуля и функции
2. `context.md` - файл контекста для быстрой ориентации ИИ ассистента в проекте при новой чат-сессии из-за ограничений размера контекста
3. `tasks.md` - список задач проекта

Эти файлы должны актуализироваться после выполнения каждой задачи.

### Синхронизация документации (КРИТИЧЕСКИ ВАЖНО)
При изменении любого документа или важного файла проекта ОБЯЗАТЕЛЬНО:
1. Идентифицировать все файлы, которые могут содержать похожую информацию (концепция, README, техстек, архитектура)
2. Проверить каждый файл на предмет устаревшей информации
3. Обновить все связанные упоминания технологий, версий, дат
4. Убедиться в консистентности между всеми документами проекта

Особенно важно для версий технологий, дат, названий компонентов, архитектурных решений.

### Обновление контекста между сессиями
Если пользователь пишет: "Подготовься к началу новой сессии" (или аналогично), ОБЯЗАТЕЛЬНО обнови все файлы в `docs/` (CURSOR_CONTEXT.md, PROJECT_OVERVIEW.md, TASKS.md, DESIGN_SYSTEM.md, PROJECT_MODULES.md) с актуальной датой/временем и состоянием проекта.

### Работа с задачами (ПОШАГОВЫЙ ПОДХОД)
1. Выполни задачу
2. Отдай результат выполнения пользователю для тестирования
3. Дождись утверждения пользователя
4. Только после утверждения переходи к следующей задаче

Документацию проекта можно обновлять ТОЛЬКО ПОСЛЕ получения утверждения от пользователя о правильно выполненной задаче. Нельзя обновлять документацию до тестирования и утверждения пользователем.

## Технологический стек

### Проверка версий (ОБЯЗАТЕЛЬНЫЙ АЛГОРИТМ)
Перед выбором любой технологии, зависимости или фреймворка:
1. Проверь текущую дату через терминал
2. Выполни веб-поиск актуальных версий каждой технологии на эту дату (например "React Native latest version")
3. Проверь официальные релизы на GitHub/npm
4. Убедись что указываются СТАБИЛЬНЫЕ версии, а не альфа/бета
5. Всегда уточняй "на [текущая дата]" в документации
6. Никогда не полагайся только на общие знания о версиях без актуальной проверки

При работе с проектом всегда проверяй версии зависимостей на совместимость. Используй веб-поиск или Context7 для получения актуальной информации.

### Конкретные технологии
- Проект использует React Native с Expo на последней доступной версии
- Всегда указывай актуальную текущую дату при указании технического стека

### UI-first подход
- Сначала верстай все экраны (дизайн и layout), затем натягивай бэкенд
- Приоритет на создание полного UI/UX интерфейса перед интеграцией с API и базой данных

### UI библиотеки (СТРОГО)
- Используй ТОЛЬКО React Native Paper для UI компонентов на всех экранах
- ЗАПРЕЩАЕТСЯ использовать другие UI библиотеки или произвольные кастомные UI решения
- Primary buttons в проекте должны быть стилизованы одинаково и использоваться последовательно во всех основных действиях
- UI типографика и размещение элементов должны соответствовать стандартным гайдлайнам дизайна проекта

## Работа с датами и временем

Перед записью даты и времени в любые файлы документации или код ОБЯЗАТЕЛЬНО сначала узнай актуальную дату и время через терминальную команду (`date` или `Get-Date` в PowerShell). Это обеспечивает точность временных меток.

## Терминал и команды

- Каждую терминальную команду выполняй отдельно
- Терминал должен закрываться после завершения каждой команды перед запуском следующей
- Если команда не удалась, повтори попытку или попробуй другой подход вместо остановки

## Git и версионирование

Обновляй файл `git-status.html` при выполнении задач контроля версий или версионирования.

## Прочая информация

- У пользователя нет Mac - нужны решения для создания проектов без Mac
- Не добавляй функционал, который не был запрошен
- Документация должна отражать переход на Paper компоненты и новый подход к стилизации
- После выполнения каждой задачи обновляй все соответствующие файлы документации и контекста проекта

## Стиль кода

### Форматирование
- Используй 2 пробела для отступов (как в .prettierrc)
- Максимальная длина строки: 100 символов
- Используй одинарные кавычки для строк
- Точка с запятой обязательна
- Всегда используй trailing commas в многострочных объектах/массивах

### Naming Conventions
- **Файлы компонентов**: PascalCase (UserCard.tsx)
- **Файлы хуков**: camelCase с префиксом use (useAuth.ts)
- **Файлы утилит**: camelCase (formatDate.ts)
- **Константы**: UPPER_SNAKE_CASE
- **Типы и интерфейсы**: PascalCase с префиксом I для интерфейсов (IUser, UserType)
- **Переменные и функции**: camelCase

### Организация импортов
1. React и React Native импорты
2. Сторонние библиотеки
3. Навигация (@react-navigation)
4. UI компоненты (react-native-paper)
5. Локальные компоненты
6. Хуки
7. Утилиты и хелперы
8. Типы
9. Стили

### Структура компонентов
```typescript
// Импорты
import React from 'react';
import { View } from 'react-native';
import { Button } from 'react-native-paper';

// Типы
interface Props {
  // ...
}

// Компонент
export const ComponentName: React.FC<Props> = ({ prop1, prop2 }) => {
  // Хуки
  // Состояние
  // Обработчики
  // Эффекты
  
  return (
    // JSX
  );
};
```

## Ограничения контекста

### Исключаемые директории
При работе с AI IDE игнорируй следующие папки:
- `node_modules/` - зависимости
- `dist/`, `build/`, `.expo/` - артефакты сборки
- `.git/` - Git служебные файлы
- `android/build/`, `ios/build/` - нативные сборки
- `coverage/` - отчёты покрытия тестов
- `.expo-shared/` - Expo служебные файлы
- `logs/`, `*.log` - логи

### Важные файлы для контекста
Приоритет при загрузке контекста:
1. `docs/CURSOR_CONTEXT.md` - быстрая ориентация
2. `README.md` - общий обзор
3. `package.json` - зависимости и скрипты
4. Файлы в `src/` - основной код
5. `docs/` - документация

## Политика изменений

### Минимальный diff
- Изменяй только те строки, которые необходимы для решения задачи
- Не переформатируй код, который не связан с изменением
- Не меняй пробелы, отступы или порядок импортов в несвязанных файлах
- Один PR = одна задача = минимум изменённых файлов

### Запрет на правки в несвязанных файлах
- Не трогай файлы, которые не относятся к текущей задаче
- Если нужны изменения в нескольких модулях - разбей на несколько PR
- Документацию обновляй только после утверждения кода

### Обратная совместимость
- Не меняй публичные API без необходимости
- Поддерживай существующие интерфейсы при рефакторинге
- Используй deprecation warnings перед удалением функционала
- Обновляй версию в package.json согласно semver

## Зависимости

### Правила добавления новых библиотек
1. **Проверь необходимость**: можно ли решить без новой зависимости?
2. **Проверь совместимость**: работает ли с текущими Expo SDK 54, React Native 0.82?
3. **Проверь лицензию**: MIT, Apache 2.0, BSD - разрешены
4. **Проверь поддержку**: активная разработка, недавние коммиты
5. **Проверь размер**: bundle size impact
6. **Документируй**: добавь в CHANGELOG.md причину добавления

### Контроль лицензий
- ✅ Разрешены: MIT, Apache 2.0, BSD, ISC
- ⚠️ С осторожностью: LGPL (требует анализа)
- ❌ Запрещены: GPL, AGPL (вирусные лицензии)

### Обновление зависимостей
- Используй точные версии в production зависимостях
- Регулярно проверяй `npm audit` на уязвимости
- Тестируй приложение после обновления major версий
- Документируй breaking changes в MIGRATION_GUIDE.md

## Тестирование

### Требования к покрытию
- **Целевое покрытие**: ≥80% для новых модулей
- **Минимальное покрытие**: ≥60% для существующего кода
- **Критический функционал**: 100% (аутентификация, платежи)

### Обязательные тесты для багфиксов
При исправлении бага ОБЯЗАТЕЛЬНО:
1. Создай тест, воспроизводящий баг (должен падать на старом коде)
2. Исправь баг
3. Убедись, что тест проходит
4. Добавь edge cases если нужно

### Типы тестов
- **Unit тесты**: для утилит, хуков, бизнес-логики
- **Component тесты**: для UI компонентов
- **Integration тесты**: для взаимодействия модулей
- **E2E тесты**: для критических user flows

### Структура тестов
```typescript
describe('ComponentName', () => {
  it('should handle happy path', () => {
    // Arrange
    // Act
    // Assert
  });

  it('should handle edge case: empty data', () => {});
  it('should handle error state', () => {});
});
```

## Безопасность

### Запрет на коммит секретов
- ❌ НИКОГДА не коммить API ключи, токены, пароли
- ❌ НИКОГДА не коммить .env файлы с реальными данными
- ✅ Используй .env.example с placeholder значениями
- ✅ Добавь секретные файлы в .gitignore

### Правила работы с env-файлами
1. `.env.example` - шаблон с placeholder'ами, коммитится в Git
2. `.env` - реальные значения, в .gitignore
3. Используй `expo-constants` для доступа к env переменным
4. Документируй все env переменные в README.md

### Проверки безопасности
- Регулярно запускай `npm audit`
- Не используй deprecated зависимости
- Валидируй все пользовательские вводы
- Используй HTTPS для всех API запросов

## Инструкции для AI

### Формат ответов
- **patch only**: только код изменений, без объяснений
- **minimal diff**: минимальные изменения, только суть
- **no prose**: без длинных текстовых объяснений (если не запрошено)
- **code + tests**: код вместе с тестами
- **code + docs**: код вместе с документацией

### Приоритеты при работе
1. Понять контекст задачи (читай @file, @workspace)
2. Найти минимальное решение (меньше кода = лучше)
3. Следовать существующим паттернам проекта
4. Сохранить обратную совместимость
5. Добавить тесты для нового функционала
6. Обновить документацию только если изменилось API

### Структура работы над задачей
1. Изучи контекст: README, CURSOR_CONTEXT, связанные файлы
2. Предложи подход (если задача сложная)
3. Реализуй минимальное решение
4. Добавь тесты (если нужно)
5. Проверь линтеры и типы
6. Жди подтверждения перед переходом к следующему шагу

### Что НЕ делать
- ❌ Не переписывай рабочий код "для красоты"
- ❌ Не добавляй функционал "на будущее"
- ❌ Не меняй архитектуру без необходимости
- ❌ Не трогай файлы, не связанные с задачей
- ❌ Не обновляй документацию до утверждения кода

## Итог

Все правила применяй последовательно и учитывай при каждой работе с проектом. Приоритет: минимальные изменения, следование существующим паттернам, сохранение обратной совместимости.

